
<html>
    <head>
        <style>
            .myBtn {
                font-family: Arial;
                color: #faaa20;
                font-size: 20px;
                background: #3498db;
                padding: 10px 20px 10px 20px;
                text-decoration: none;
            }
            #close-btn {
                font-family: Arial;
                color: #faaa20;
                font-size: 20px;
                background: #3498db;
                padding: 10px 20px 10px 20px;
                text-decoration: none;
            }

        </style>
        <!-- <script src="https://media-library.cloudinary.com/global/all.js"></script> -->
        <!-- <script src="../../media-library-cms/dist/global/all.js"></script> -->
    </head>
    <body>
        <div class="cld-cms" style="text-align: center;"><h1>CMS demo</h1></div>
        <div class="opener-wrapper" style="text-align: center; margin-bottom: 30px;">
            <button id="open-btn" onclick="openMl()">Open ML</button>
            <button id="close-btn" class='myBtn' onclick="closeMl()">Close</button>
        </div>
        <div>
            <div class="cms-container" style="width: 80%; height: 700px; margin: 0 auto 50px; border: 1px solid black; background: #d0dae2"></div>
            <div style="color: white; background-color:black; text-align:center; width: 80%; height: 500px; position: relative; margin: 0 auto 50px; border: 1px solid black; overflow: scroll;">
                <h3 style='margin-top: 6px;'>Console:</h3>
                <textarea id="output" lines=5 style="color: white; background-color:black; width: 100%; height: 93%; position:absolute; bottom: 0; left: 0; right: 0;"></textarea>
            </div>
        </div>
    </body>
    <script>

        // https://stackoverflow.com/questions/901115/how-can-i-get-query-string-values-in-javascript
        const demoPublicIds = ['1/tumblr_m07iyfLy0F1qce1ag',
                                '1/NUMBER-ONE',
                                '24/h2zmy0ytyygwgpelqrwz',
                                '24/couple_mnclpc',
                                '24/cookies123_sbwefe',
                                '24/jwbcsxoniy8xm86aidyf',
                                '24/t7eqqjclqqzbgnyjhv3z']
        function getQueryParam(names) {
            const url = window.location.href;
            const paramsHash = names.reduce((result, name) => {
                name = name.replace(/[\[\]]/g, "\\$&");
                var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                    results = regex.exec(url);
                if (!results) return result;
                const value = decodeURIComponent(results[2].replace(/\+/g, " "));
                result[name] = (value === "true") ? true : (value === "false") ? false : value;
                return result;
            }, {})
            return paramsHash || {};
        }

        function insertHandler(data){
            console.log("insert handler")
            data.assets.forEach(asset => {
                console.log("Inserted:", asset)
                const my_console = document.getElementById("output")
                my_console.value = `${my_console.value}${JSON.stringify(asset, null, 2)}\n\n`
            })
        }

        function errorHandler(data){
            console.log("Error:", data)
            const my_console = document.getElementById("output")
            my_console.value = `\n\n ***** ERROR ***** \n ${my_console.value}${data.status}: ${data.message}\n\n`
        }

        let config

    </script>
    <script>
        (function() {

            const env = getQueryParam(["env"])["env"]
            var JSLink =  env === 'dev' ? "../../media-library-cms/dist/global/all.js" : `https://media-library${env ? "-"+env : ""}.cloudinary.com/global/all.js?a=1`;
            var JSElement = document.createElement('script');
            JSElement.src = JSLink;
            JSElement.onload = OnceLoaded;
            document.getElementsByTagName('head')[0].appendChild(JSElement);

            function OnceLoaded() {
                const insertCaption = getQueryParam(["insert_caption"])["insert_caption"];
                const removeHeader = getQueryParam(["remove_header"])["remove_header"];
                const inlineMode = getQueryParam(["inline"])["inline"];
                const defaultTransformations = getQueryParam(["default_transformations"])["default_transformations"];
                const z_index = getQueryParam(["z_index"])["z_index"];
                const env = getQueryParam(["env"])["env"];
                const cloud_name = getQueryParam(["cloud_name"])["cloud_name"];
                const options = getQueryParam(["multiple", "max_files", "insert_transformation", "cloud_name", "api_key", "username", "timestamp", "signature"])
                console.log("options", options)
                config = Object.assign({
                    dev: env === 'dev' ? true: null, // TODO: cookie based env settings
                    staging: env === 'staging' ? true: null, // TODO: cookie based env settings
                    // cloud_name: 'cloudinary',
                    // api_key: 'cloudinary',
                    // username: 'user@example.com',
                    // timestamp: '1234567890',
                    // signature: 'abcdefgh',
                    inline_container: inlineMode ? '.cms-container' : null,
                    z_index: z_index,
                    default_transformations: defaultTransformations ? [[{width: 100, height:100, crop: "limit"},{overlay: "text:arial_30:hello", width: 100}], [{width: 50, crop: "crop", gravity: "auto"}]] : null,
                    button_class: 'myBtn',
                    button_caption: 'Open Media-Library',
                    remove_header: removeHeader,
                    insert_caption: insertCaption === "null" ? null : insertCaption,
                    folder: {path: "Super", resource_type: "image"},
                    // edit_asset: {url: 'http://res.cloudinary.com/demo/image/upload/a_45/sample.jpg', public_id: "sample", "zzz-2", resource_type: "image",type: "upload", transformation: 'c_scale,h_5,w_5/c_scale,h_500,w_500'}
                    // edit_asset: {url: 'http://res.cloudinary.com/demo/image/upload/a_45/sample.jpg', public_id: "sample", demoPublicIds[Math.floor(Math.random()*5)+1], resource_type: "image", type: "upload", transformation: 'c_scale,h_5,w_5/c_scale,h_500,w_508'}
                    // multiple: true,
                    // max_files: 8,
                    // insert_transformation: true,
                    // default_transformations: [{}],
                }, options)
                window.ml = cloudinary.createMediaLibrary(config, {insertHandler: insertHandler, errorHandler: errorHandler}) //, document.getElementById("open-btn"))

            }
        })();
    </script>
    <script>
        function openMl(){
            const publicId = demoPublicIds[Math.floor(Math.random()*5)+1]
            // window.ml.show({config: {
            //     max_files: Math.floor(Math.random()*10)+1,
            //     insert_transformation: Math.random() > 0.5,
            //     asset: {mode: "edit", url: `https://res-dev.cloudinary.com/cloudinary/image/upload/w_300,h_500,c_scale/a_45/v1533043996/${publicId}.jpg`}
            // }});
            window.ml.show()
            }
        function closeMl(){
            window.ml.hide();
        }
    </script>

</html>
